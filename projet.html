<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/node_modules/@picocss/pico/css/pico.min.css">
    <title>NFTS ECV</title>

    <link href="style.css" rel="stylesheet">
</head>
<style>
    .hidden {
        display: none;
    }
</style>

<body class="home">
    <h1>Bienvenue sur le site de NFT</h1>
</body>
<script type="text/javascript">
    const root = document.querySelector('body');
    let myNfts = [];

    const myListOfcreator = createElement('select');
    myListOfcreator.setAttribute('style', `width: 30%;`);

    const items = document.getElementsByTagName('article');
    console.log(items.length)
    myListOfcreator.addEventListener('change', e => {
        input = e.target.value;
        var pat = new RegExp(input, 'i');
        for (var i = 0; i < items.length; i++) {
            var item = items[i];
            if (pat.test(item.innerText)) {
                item.classList.remove("hidden");
            }
            else {
                console.log(item);
                item.classList.add("hidden");
            }
        }
    });

    const myListOfSales = createElement('select');
    myListOfSales.setAttribute('style', `width: 30%;`);
    myListOfSales.addEventListener('change', e => {
        input = e.target.value;
        var pat = new RegExp(input, 'i');
        for (var i = 0; i < items.length; i++) {
            var item = items[i];
            if (pat.test(item.innerText)) {
                item.classList.remove("hidden");
            }
            else {
                console.log(item);
                item.classList.add("hidden");
            }
        }
    });
    const myInput = createElement('input');
    myInput.setAttribute('id', 'search');
    myInput.setAttribute('style', `width: 40%;`);

    myInput.addEventListener('keyup', e => {
        const searchString = e.target.value;
        const filteredNfts = myNfts.filter((character) => {
            return (
                character.sales.toLowerCase().includes(searchString)
            );
        });
        console.log(filteredNfts);
    });


    async function nft() {
        try {
            const response = await fetch('https://awesome-nft-app.herokuapp.com/');
            const res = await response.json();
            myNfts = res.assets;
            myNfts = myNfts.filter(function (val) {
                return val.creator.username != '';
            })
            createCards(myNfts);
        } catch (error) {

            console.log(error);

        }
    }

    function createElement(tag, config, parent = null) {
        const {
            text,
            classe,
            color,
            href,
            role,
            event
        } = config || {};

        const element = document.createElement(tag);

        if (classe) {
            element.classList.add(classe);
        }
        if (event) {
            element.onclick = event;
        }
        if (role) {
            element.setAttribute("role", "button");
        }
        if (href) {
            element.href = href;
        }
        if (color) {
            element.style.color = color;
        }
        if (text) {
            element.innerHTML = text;
        }
        if (!parent) {
            root.appendChild(element);
        } else {
            parent.appendChild(element);
        }
        return element;
    }

    const myDiv = createElement('div');

    function createCards(data) {
        data.forEach(el => {
            myDiv.setAttribute('class', `items`);
            mySelect = createElement('option', {
                text: `<select id="listOfCreator" name="creators">
                            <option value="${el.creator.username}" >${el.creator.username}</option>
                    </select>`,
            }, myListOfcreator);

            mySelectNumberOfSale = createElement('option', {
                text: `<select id="listOfSale" name="sales">
                            <option value="${el.sales}" >${el.sales}</option>
                    </select>`,
            }, myListOfSales);

            myCard = createElement('article', {}, myDiv);
            myImg = createElement('img', {
                classe: 'nft_img',
            }, myCard);
            myImg.src = el.image_url;
            createElement('h2', {
                text: el.name,
            }, myCard);
            if (el.creator.username) {
                createElement('p', {
                    text: `<span>by</span> ${el.creator.username}`,
                }, myCard);
            } else {
                createElement('p', {
                    text: 'anonymous creator'
                }, myCard);
            }
            createElement('span', {
                classe: 'sales',
                text: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V6l-3-4H6zM3.8 6h16.4M16 10a4 4 0 1 1-8 0"/></svg> ${el.sales}`,
            }, myCard);
            myCardFooter = createElement('footer', {}, myCard);
            createElement('a', {
                text: 'En savoir plus',
                href: `/nft.html?id=${el.id}`,
                role: "button"
            }, myCardFooter);
            createElement('p', {
                event: 'console.log("test")',
                text: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>',
            }, myCardFooter);
        })
    }

    nft();

</script>

</html>